<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Match</title>
    <style>
        .tile {
            font-size: xx-large;
            width: 50px;
            height: 50px;
            line-height: 50px;
            background-color: gray;
            text-align: center;
        }

        td {
            width: 55px;
            height: 55px;
        }
    </style>
</head>
<body>
    <a href="../index.html">Home</a>
    <h1>Welcome to Memory Match</h1>
    <p><button onclick="resetBoard()">Reset Game</button></p>
    <p>Guesses: <span id="guesses"></span></p>
    <p>Matches: <span id="matches">0</span>/<span id="outOf"></span></p>
    <div id="gameBoard"></div>

    <script>
        let map = []
        let tile1 = null, tile2 = null;
        let guesses = 0;
        let matches = 0;

        // TODO: Write the project code
        const shuffle = (array) => {
            for (let i = array.length - 1; i > 0; i--){
                const j = Math.floor(Math.random() * (i + 1));
                let temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
            return array;
        }

        const loadMap = (rows = 4, cols = 4) => {
            let maxPairs = rows * cols / 2;
            let numPairs = []
            for (let i = 1; i <= maxPairs; i++){
                numPairs.push(i);
                numPairs.push(i);
            }
            let shuffledBoard = shuffle(numPairs);
            let i = 0;

            for (let row = 0; row < rows; row++) {
                let currRow = []
                for (let col = 0; col < cols; col++){
                    currRow.push(shuffledBoard[i]);
                    i++;
                }
                map.push(currRow);
            }
            document.getElementById("outOf").innerHTML = maxPairs;
        }

        const makeBoard = (rows = 4, cols = 4) => {
            let output = "<table>";
            for (let row = 0; row < rows; row++){
                output += "<tr>";
                for (let col = 0; col < cols; col++) {
                    output += `<td><button` +
                    ` class="tile"` +
                    ` id="` + row + `_` + col + `"` +
                    ` onclick="process(` + row + `,` + col + `)">` +
                    `</button></td>`;
                }
                output += `</tr>`;
            }
            document.getElementById("gameBoard").innerHTML = output + "</table>";
        }

        let resetBoard = () => {
            loadMap();
            makeBoard();
        }
        
        let process = (row, col) => {
            let clicked_tile = document.getElementById(row + '_' + col);

            // Clicked tile not already contains data
            if (!Boolean(clicked_tile.innerHTML)){

                // Tile 1 not yet selected
                if (!tile1) {
                    tile1 = clicked_tile;
                    clicked_tile.innerHTML = map[row][col];
                }

                // Tile 2 not yet selected
                else if (!tile2) {
                    tile2 = clicked_tile;
                    clicked_tile.innerHTML = map[row][col];
                    document.getElementById("guesses").innerHTML = ++guesses;
                }
                // TODO: Set timeout callback function
                setTimeout(checkMatch, 1000);
            }
        }

        let checkMatch = () => {
            if (tile1.innerHTML == tile2.innerHTML) {
                tile1.hidden = true;
                tile2.hidden = true;
                document.getElementById("matches").innerHTML = ++matches;
            }

            tile1.innerHTML = "";
            tile2.innerHTML = "";
            tile1 = tile2 = null;
        }

    </script>
</body>
</html>